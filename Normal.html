<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Normal Distribution Calculator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/3.0.1/chartjs-plugin-annotation.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/>
<style>
        :root {
            --primary-bg: #3a3f4b;
            --secondary-bg: #4a4f5c;
            --accent-blue: #4a90e2;
            --accent-green: #5cb85c;
            --accent-red: #d9534f;
            --text-primary: #fff;
            --text-secondary: #ccc;
            --border-color: #555;
            --highlight-color: #ffc0c0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            width: 100%;
  max-width: 100%;
  margin: 0 auto;
  overflow-x: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 240px 570px;
            height: 100vh;
            width: 100%;
            max-width: 810px;
            gap: 0;
        }

        /* Left Panel - Controls */
        .left-panel {
            max-width: 180px;
            background: var(--secondary-bg);
            padding: 20px;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            position: relative;
            z-index: 10;
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .panel-header i {
            color: var(--accent-blue);
            font-size: 18px;
        }

        .panel-header h3 {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .input-field {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--primary-bg);
            color: var(--text-primary);
            font-size: 13px;
            transition: border-color 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .calculation-type {
            margin-bottom: 20px;
        }

        .calculation-type h4 {
            margin-bottom: 12px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .radio-option:hover {
            border-color: var(--accent-blue);
            background: rgba(74, 144, 226, 0.1);
        }

        .radio-option.selected {
            border-color: var(--accent-blue);
            background: rgba(74, 144, 226, 0.15);
        }

        .radio-option input[type="radio"] {
            margin-right: 8px;
            accent-color: var(--accent-blue);
        }

        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #357abd;
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
            margin-top: 10px;
        }

        .btn-success:hover {
            background: #449d44;
        }

        .advanced-options {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .advanced-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: var(--accent-blue);
            font-size: 12px;
            margin-bottom: 10px;
        }

        .advanced-content {
            display: none;
        }

        .advanced-content.show {
            display: block;
        }

        /* Right Panel - Visualization */
        .right-panel {
         
            width: 500px;
            min-width: 0;
            background: var(--primary-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        .header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .header p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .tabs {
            display: flex;
            background: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab:hover {
            color: var(--text-primary);
            background: rgba(255,255,255,0.05);
        }

        .tab.active {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
            background: rgba(74, 144, 226, 0.1);
        }

        .chart-area {
            flex: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }

        .shaded-area-section {
            margin-top: 15px;
            padding: 15px;
            background: var(--secondary-bg);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .shaded-area-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .shaded-area-header h4 {
            font-size: 13px;
            color: var(--text-primary);
        }

        .shaded-area-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--primary-bg);
            border-radius: 4px;
            font-size: 12px;
        }

        .area-value {
            font-weight: bold;
            color: var(--highlight-color);
        }

        .results-section {
            margin-top: 15px;
            padding: 15px;
            background: var(--secondary-bg);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .results-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .results-header h4 {
            font-size: 13px;
            color: var(--text-primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
        }

        .stat-item {
            background: var(--primary-bg);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-item.primary {
            border-color: var(--accent-blue);
            background: rgba(74, 144, 226, 0.1);
        }

        .stat-value {
            font-size: 12px;
            font-weight: bold;
            color: var(--highlight-color);
        }

        .stat-item.primary .stat-value {
            color: var(--accent-blue);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .tab-content {
            display: none;
            height: auto;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
            height: auto;
        }

        .chart-indicators {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .x-marker {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid;
        }

        .x-marker::before {
            content: '';
            width: 3px;
            height: 16px;
            border-radius: 1px;
        }

        /* Responsive adjustments */
        @media (max-width: 810px) {
            .container {
                grid-template-columns: 200px 450px;
                max-width: 650px;
                gap: 0;
            }
            
            .left-panel {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 650px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                max-width: 100%;
            }
            
            .left-panel {
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .right-panel {
                height: auto;
            }
        }
    </style>
<style>
#resizeNotice {
  background-color: #fffae6;
  color: #333;
  text-align: center;
  padding: 10px;
  font-size: 14px;
  font-weight: bold;
  border-bottom: 2px solid #f0c36d;
}
</style><style>
body, html {
  margin: 0;
  padding: 0;
  width: 100%;
  box-sizing: border-box;
  font-family: 'Segoe UI', sans-serif;
  background-color: #1e1e2f;
  color: white;
}

.container {
  display: flex;
  flex-wrap: wrap;
  margin: 0 auto;
  padding: 10px;
  max-width: 1000px;
  box-sizing: border-box;
}

.left-panel, .right-panel {
  flex: 1 1 100%;
  padding: 10px;
  box-sizing: border-box;
}

@media (min-width: 768px) {
  .left-panel {
    flex: 1 1 35%;
  }
  .right-panel {
    flex: 1 1 65%;
  }
}
</style></head>
<body>
<div class="container">
<!-- Left Panel - Controls -->
<div class="left-panel">
<div class="panel-header">
<i class="fas fa-sliders-h"></i>
<h3>Distribution Parameters</h3>
</div>
<div class="input-group">
<label>Mean (μ)</label>
<input class="input-field" id="mean" step="0.1" type="number" value="0"/>
</div>
<div class="input-group">
<label>Standard Deviation (σ)</label>
<input class="input-field" id="stddev" min="0.01" step="0.1" type="number" value="1"/>
</div>
<div class="calculation-type">
<h4>Calculation Type</h4>
<div class="radio-group">
<label class="radio-option selected">
<input checked="" name="calcType" type="radio" value="probability"/>
                        Find Probability P(X ≤ x)
                    </label>
<label class="radio-option">
<input name="calcType" type="radio" value="between"/>
                        Find P(a ≤ X ≤ b)
                    </label>
<label class="radio-option">
<input name="calcType" type="radio" value="quantile"/>
                        Find Value for Given Probability
                    </label>
</div>
</div>
<div id="inputSection">
<div class="input-group">
<label>X Value</label>
<input class="input-field" id="xValue" step="0.1" type="number" value="0"/>
</div>
</div>
<button class="btn btn-primary" onclick="calculate()">
<i class="fas fa-calculator"></i>
                Calculate
            </button>
<button class="btn btn-success" onclick="reloadCalculator()">
<i class="fas fa-redo"></i>
                Reset Calculator
            </button>
<div class="advanced-options">
<div class="advanced-toggle" onclick="toggleAdvanced()">
<i class="fas fa-cogs"></i>
                    Advanced Options
                    <i class="fas fa-chevron-down" id="advancedIcon"></i>
</div>
<div class="advanced-content" id="advancedContent">
<div class="input-group">
<label>Decimal Precision</label>
<select class="input-field" id="precision">
<option value="2">2 decimals</option>
<option value="3">3 decimals</option>
<option selected="" value="4">4 decimals</option>
<option value="5">5 decimals</option>
<option value="6">6 decimals</option>
</select>
</div>
<div class="input-group">
<label>Chart Range (σ units)</label>
<input class="input-field" id="chartRange" max="6" min="2" step="0.5" type="number" value="4"/>
</div>
</div>
</div>
</div>
<!-- Right Panel - Visualization -->
<div class="right-panel">
<div class="header">
<h1>Interactive Normal Distribution</h1>
</div>
<div class="tabs">
<div class="tab active" onclick="switchTab('pdf')">PDF View</div>
<div class="tab" onclick="switchTab('cdf')">CDF View</div>
<div class="tab" onclick="switchTab('both')">Combined View</div>
</div>
<div class="chart-area">
<div class="tab-content active" id="pdfTab">
<div class="chart-container">
<canvas id="pdfChart"></canvas>
</div>
</div>
<div class="tab-content" id="cdfTab">
<div class="chart-container">
<canvas id="cdfChart"></canvas>
</div>
</div>
<div class="tab-content" id="bothTab">
<div class="chart-container">
<canvas id="combinedChart"></canvas>
</div>
</div>
<div class="shaded-area-section">
<div class="shaded-area-header">
<i class="fas fa-area-chart"></i>
<h4>Shaded Area Representation</h4>
</div>
<div class="shaded-area-info">
<span id="areaDescription">P(X ≤ 0)</span>
<span class="area-value" id="areaValue">50.0000%</span>
</div>
</div>
<div class="results-section">
<div class="results-header">
<i class="fas fa-chart-bar"></i>
<h4>Results &amp; Statistics</h4>
</div>
<div class="stats-grid">
<div class="stat-item primary">
<div class="stat-value" id="mainResult">0.5000</div>
<div class="stat-label">Result</div>
</div>
<div class="stat-item">
<div class="stat-value" id="meanStat">0</div>
<div class="stat-label">Mean (μ)</div>
</div>
<div class="stat-item">
<div class="stat-value" id="stddevStat">1</div>
<div class="stat-label">Std Dev (σ)</div>
</div>
<div class="stat-item">
<div class="stat-value" id="varianceStat">1</div>
<div class="stat-label">Variance (σ²)</div>
</div>
<div class="stat-item">
<div class="stat-value" id="medianStat">0</div>
<div class="stat-label">Median</div>
</div>
<div class="stat-item">
<div class="stat-value" id="modeStat">0</div>
<div class="stat-label">Mode</div>
</div>
<div class="stat-item">
<div class="stat-value" id="skewnessStat">0</div>
<div class="stat-label">Skewness</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script>
        let pdfChart, cdfChart, combinedChart;
        let currentCalcType = 'probability';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Chart === 'undefined') {
                setTimeout(() => {
                    initializeApp();
                }, 100);
            } else {
                initializeApp();
            }
        });

        function initializeApp() {
            try {
                initializeCharts();
                updateInputSection();
                updateRadioSelection();
                updateStatistics();
                calculate();
                
                // Add event listeners
                document.getElementById('mean').addEventListener('input', debounce(calculate, 300));
                document.getElementById('stddev').addEventListener('input', debounce(calculate, 300));
                document.getElementById('chartRange').addEventListener('input', debounce(calculate, 300));
                
                const initialXValue = document.getElementById('xValue');
                if (initialXValue) {
                    initialXValue.addEventListener('input', debounce(calculate, 300));
                }
                
                document.querySelectorAll('input[name="calcType"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        currentCalcType = this.value;
                        updateInputSection();
                        updateRadioSelection();
                        calculate();
                    });
                });
                
            } catch (error) {
                console.error('Initialization error:', error);
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function updateRadioSelection() {
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`input[value="${currentCalcType}"]`).closest('.radio-option').classList.add('selected');
        }

        function updateInputSection() {
            const inputSection = document.getElementById('inputSection');
            const calcType = document.querySelector('input[name="calcType"]:checked').value;
            
            let html = '';
            
            switch(calcType) {
                case 'probability':
                    html = `
                        <div class="input-group">
                            <label>X Value</label>
                            <input type="number" id="xValue" class="input-field" value="0" step="0.1">
                        </div>
                    `;
                    break;
                case 'between':
                    html = `
                        <div class="input-group">
                            <label>Lower Bound (a)</label>
                            <input type="number" id="lowerBound" class="input-field" value="-1" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Upper Bound (b)</label>
                            <input type="number" id="upperBound" class="input-field" value="1" step="0.1">
                        </div>
                    `;
                    break;
                case 'quantile':
                    html = `
                        <div class="input-group">
                            <label>Probability (0 to 1)</label>
                            <input type="number" id="probability" class="input-field" value="0.5" step="0.01" min="0" max="1">
                        </div>
                    `;
                    break;
            }
            
            inputSection.innerHTML = html;
            
            inputSection.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', debounce(calculate, 300));
            });
        }

        function initializeCharts() {
            try {
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js not loaded');
                    return;
                }

                if (typeof chartjs_plugin_annotation !== 'undefined') {
                    Chart.register(chartjs_plugin_annotation);
                }

                // PDF Chart
                const pdfCtx = document.getElementById('pdfChart');
                if (!pdfCtx) return;
                
                pdfChart = new Chart(pdfCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Probability Density',
                            data: [],
                            borderColor: '#4a90e2',
                            backgroundColor: 'rgba(74, 144, 226, 0.1)',
                            fill: false,
                            tension: 0,
                            pointRadius: 0,
                            pointHoverRadius: 0,
                            borderWidth: 2
                        }, {
                            label: 'Shaded Area',
                            data: [],
                            borderColor: 'rgba(255, 192, 192, 0.8)',
                            backgroundColor: 'rgba(255, 192, 192, 0.3)',
                            fill: true,
                            tension: 0,
                            pointRadius: 0,
                            pointHoverRadius: 0,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: 'white' }
                            },
                            annotation: {
                                annotations: {}
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                title: { display: true, text: 'X', color: 'white' },
                                ticks: { color: 'white' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                title: { display: true, text: 'Density', color: 'white' },
                                ticks: { color: 'white' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });

                // CDF Chart
                const cdfCtx = document.getElementById('cdfChart');
                if (cdfCtx) {
                    cdfChart = new Chart(cdfCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'Cumulative Probability',
                                data: [],
                                borderColor: '#5cb85c',
                                backgroundColor: 'rgba(92, 184, 92, 0.1)',
                                fill: false,
                                tension: 0,
                                pointRadius: 0,
                                pointHoverRadius: 0,
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: { color: 'white' }
                                },
                                annotation: {
                                    annotations: {}
                                }
                            },
                            scales: {
                                x: {
                                    type: 'linear',
                                    title: { display: true, text: 'X', color: 'white' },
                                    ticks: { color: 'white' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                },
                                y: {
                                    title: { display: true, text: 'P(X ≤ x)', color: 'white' },
                                    ticks: { color: 'white' },
                                    grid: { color: 'rgba(255,255,255,0.1)' },
                                    min: 0,
                                    max: 1
                                }
                            }
                        }
                    });
                }

                // Combined Chart
                const combinedCtx = document.getElementById('combinedChart');
                if (combinedCtx) {
                    combinedChart = new Chart(combinedCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'PDF',
                                data: [],
                                borderColor: '#4a90e2',
                                backgroundColor: 'rgba(74, 144, 226, 0.1)',
                                fill: false,
                                tension: 0,
                                pointRadius: 0,
                                pointHoverRadius: 0,
                                borderWidth: 2,
                                yAxisID: 'y'
                            }, {
                                label: 'CDF',
                                data: [],
                                borderColor: '#5cb85c',
                                backgroundColor: 'rgba(92, 184, 92, 0.1)',
                                fill: false,
                                tension: 0,
                                pointRadius: 0,
                                pointHoverRadius: 0,
                                borderWidth: 2,
                                yAxisID: 'y1'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: { color: 'white' }
                                },
                                annotation: {
                                    annotations: {}
                                }
                            },
                            scales: {
                                x: {
                                    type: 'linear',
                                    title: { display: true, text: 'X', color: 'white' },
                                    ticks: { color: 'white' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                },
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'PDF', color: 'white' },
                                    ticks: { color: 'white' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'CDF', color: 'white' },
                                    ticks: { color: 'white' },
                                    grid: { drawOnChartArea: false },
                                    min: 0,
                                    max: 1
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Chart initialization error:', error);
            }
        }

        function normalPDF(x, mean, stddev) {
            return (1 / (stddev * Math.sqrt(2 * Math.PI))) * 
                   Math.exp(-0.5 * Math.pow((x - mean) / stddev, 2));
        }

        function normalCDF(x, mean, stddev) {
            return 0.5 * (1 + erf((x - mean) / (stddev * Math.sqrt(2))));
        }

        function erf(x) {
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;

            const sign = x < 0 ? -1 : 1;
            x = Math.abs(x);

            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);

            return sign * y;
        }

        function normalQuantile(p, mean, stddev) {
            if (p <= 0) return -Infinity;
            if (p >= 1) return Infinity;
            if (p === 0.5) return mean;
            
            let x;
            if (p < 0.5) {
                x = -normalQuantileApprox(1 - p);
            } else {
                x = normalQuantileApprox(p);
            }
            
            return mean + stddev * x;
        }

        function normalQuantileApprox(p) {
            const c0 = 2.515517;
            const c1 = 0.802853;
            const c2 = 0.010328;
            const d1 = 1.432788;
            const d2 = 0.189269;
            const d3 = 0.001308;
            
            if (p > 0.5) {
                const t = Math.sqrt(-2 * Math.log(1 - p));
                return t - (c0 + c1 * t + c2 * t * t) / (1 + d1 * t + d2 * t * t + d3 * t * t * t);
            } else {
                const t = Math.sqrt(-2 * Math.log(p));
                return -(t - (c0 + c1 * t + c2 * t * t) / (1 + d1 * t + d2 * t * t + d3 * t * t * t));
            }
        }

        function calculate() {
            try {
                const mean = parseFloat(document.getElementById('mean').value) || 0;
                const stddev = parseFloat(document.getElementById('stddev').value) || 1;
                const precision = parseInt(document.getElementById('precision')?.value) || 4;
                const calcType = document.querySelector('input[name="calcType"]:checked').value;
                
                if (stddev <= 0) {
                    const mainResultEl = document.getElementById('mainResult');
                    if (mainResultEl) mainResultEl.textContent = 'Error';
                    return;
                }
                
                let result, areaDescription;
                
                switch(calcType) {
                    case 'probability':
                        const xValue = parseFloat(document.getElementById('xValue')?.value) || 0;
                        result = normalCDF(xValue, mean, stddev);
                        areaDescription = `P(X ≤ ${xValue})`;
                        break;
                        
                    case 'between':
                        const lowerBound = parseFloat(document.getElementById('lowerBound')?.value) || -1;
                        const upperBound = parseFloat(document.getElementById('upperBound')?.value) || 1;
                        const lowerProb = normalCDF(lowerBound, mean, stddev);
                        const upperProb = normalCDF(upperBound, mean, stddev);
                        result = upperProb - lowerProb;
                        areaDescription = `P(${lowerBound} ≤ X ≤ ${upperBound})`;
                        break;
                        
                    case 'quantile':
                        const probability = parseFloat(document.getElementById('probability')?.value) || 0.5;
                        if (probability < 0 || probability > 1) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = 'Error';
                            return;
                        }
                        result = normalQuantile(probability, mean, stddev);
                        areaDescription = `X such that P(X ≤ x) = ${probability}`;
                        break;
                }
                
                const mainResultEl = document.getElementById('mainResult');
                if (mainResultEl) {
                    mainResultEl.textContent = result.toFixed(precision);
                }
                
                const areaDescEl = document.getElementById('areaDescription');
                if (areaDescEl) areaDescEl.textContent = areaDescription;
                
                const areaValueEl = document.getElementById('areaValue');
                if (areaValueEl) {
                    const displayValue = calcType === 'quantile' ? result.toFixed(precision) : (result * 100).toFixed(precision - 2) + '%';
                    areaValueEl.textContent = displayValue;
                }
                
                updateStatistics();
                updateCharts();
                
            } catch (error) {
                console.error('Calculation error:', error);
                const mainResultEl = document.getElementById('mainResult');
                if (mainResultEl) mainResultEl.textContent = 'Error';
            }
        }

        function updateStatistics() {
            const mean = parseFloat(document.getElementById('mean')?.value) || 0;
            const stddev = parseFloat(document.getElementById('stddev')?.value) || 1;
            const precision = parseInt(document.getElementById('precision')?.value) || 4;
            
            const meanStatEl = document.getElementById('meanStat');
            const stddevStatEl = document.getElementById('stddevStat');
            const varianceStatEl = document.getElementById('varianceStat');
            const medianStatEl = document.getElementById('medianStat');
            const modeStatEl = document.getElementById('modeStat');
            const skewnessStatEl = document.getElementById('skewnessStat');
            
            if (meanStatEl) meanStatEl.textContent = mean.toFixed(precision);
            if (stddevStatEl) stddevStatEl.textContent = stddev.toFixed(precision);
            if (varianceStatEl) varianceStatEl.textContent = (stddev * stddev).toFixed(precision);
            if (medianStatEl) medianStatEl.textContent = mean.toFixed(precision);
            if (modeStatEl) modeStatEl.textContent = mean.toFixed(precision);
            if (skewnessStatEl) skewnessStatEl.textContent = '0';
        }

        function updateCharts() {
            const mean = parseFloat(document.getElementById('mean').value) || 0;
            const stddev = parseFloat(document.getElementById('stddev').value) || 1;
            const range = parseFloat(document.getElementById('chartRange').value) || 4;
            const calcType = document.querySelector('input[name="calcType"]:checked').value;
            
            const points = 500;
            const minX = mean - range * stddev;
            const maxX = mean + range * stddev;
            const step = (maxX - minX) / points;
            
            const pdfData = [];
            const cdfData = [];
            const shadedPdfData = [];
            
            let xMarkers = [];
            switch(calcType) {
                case 'probability':
                    const xValue = parseFloat(document.getElementById('xValue')?.value) || 0;
                    xMarkers = [{ value: xValue, label: `X = ${xValue}`, color: '#ff6b6b' }];
                    break;
                case 'between':
                    const lowerBound = parseFloat(document.getElementById('lowerBound')?.value) || -1;
                    const upperBound = parseFloat(document.getElementById('upperBound')?.value) || 1;
                    xMarkers = [
                        { value: lowerBound, label: `a = ${lowerBound}`, color: '#4ecdc4' },
                        { value: upperBound, label: `b = ${upperBound}`, color: '#45b7d1' }
                    ];
                    break;
                case 'quantile':
                    const probability = parseFloat(document.getElementById('probability')?.value) || 0.5;
                    const quantileValue = normalQuantile(probability, mean, stddev);
                    xMarkers = [{ value: quantileValue, label: `X = ${quantileValue.toFixed(3)}`, color: '#96ceb4' }];
                    break;
            }
            
            for (let i = 0; i <= points; i++) {
                const x = minX + i * step;
                const pdfValue = normalPDF(x, mean, stddev);
                const cdfValue = normalCDF(x, mean, stddev);
                
                pdfData.push({ x: x, y: pdfValue });
                cdfData.push({ x: x, y: cdfValue });
                
                let inShadedArea = false;
                
                switch(calcType) {
                    case 'probability':
                        const xValue = parseFloat(document.getElementById('xValue')?.value) || 0;
                        inShadedArea = x <= xValue;
                        break;
                    case 'between':
                        const lowerBound = parseFloat(document.getElementById('lowerBound')?.value) || -1;
                        const upperBound = parseFloat(document.getElementById('upperBound')?.value) || 1;
                        inShadedArea = x >= lowerBound && x <= upperBound;
                        break;
                    case 'quantile':
                        inShadedArea = false;
                        break;
                }
                
                if (inShadedArea) {
                    shadedPdfData.push({ x: x, y: pdfValue });
                }
            }
            
            const createAnnotations = (markers) => {
                const annotations = {};
                markers.forEach((marker, index) => {
                    annotations[`xLine${index}`] = {
                        type: 'line',
                        xMin: marker.value,
                        xMax: marker.value,
                        borderColor: marker.color,
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            display: true,
                            content: marker.label,
                            position: 'top',
                            backgroundColor: marker.color,
                            color: 'white',
                            font: { size: 10, weight: 'bold' },
                            padding: 4,
                            borderRadius: 3
                        }
                    };
                });
                return annotations;
            };
            
            if (pdfChart) {
                pdfChart.data.datasets[0].data = pdfData;
                pdfChart.data.datasets[1].data = shadedPdfData;
                pdfChart.options.scales.x.min = minX;
                pdfChart.options.scales.x.max = maxX;
                
                if (pdfChart.options.plugins && pdfChart.options.plugins.annotation) {
                    pdfChart.options.plugins.annotation.annotations = createAnnotations(xMarkers);
                }
                
                pdfChart.update('none');
            }
            
            if (cdfChart) {
                cdfChart.data.datasets[0].data = cdfData;
                cdfChart.options.scales.x.min = minX;
                cdfChart.options.scales.x.max = maxX;
                
                if (cdfChart.options.plugins && cdfChart.options.plugins.annotation) {
                    cdfChart.options.plugins.annotation.annotations = createAnnotations(xMarkers);
                }
                
                cdfChart.update('none');
            }
            
            if (combinedChart) {
                combinedChart.data.datasets[0].data = pdfData;
                combinedChart.data.datasets[1].data = cdfData;
                combinedChart.options.scales.x.min = minX;
                combinedChart.options.scales.x.max = maxX;
                
                if (combinedChart.options.plugins && combinedChart.options.plugins.annotation) {
                    combinedChart.options.plugins.annotation.annotations = createAnnotations(xMarkers);
                }
                
                combinedChart.update('none');
            }
            
            updateChartIndicators(xMarkers, calcType);
        }

        function updateChartIndicators(xMarkers, calcType) {
            document.querySelectorAll('.chart-indicators').forEach(el => el.remove());
            
            const chartContainers = document.querySelectorAll('.chart-container');
            chartContainers.forEach(container => {
                const indicators = document.createElement('div');
                indicators.className = 'chart-indicators';
                
                xMarkers.forEach(marker => {
                    const markerEl = document.createElement('div');
                    markerEl.className = 'x-marker';
                    markerEl.style.borderColor = marker.color;
                    markerEl.style.color = marker.color;
                    
                    markerEl.innerHTML = `<span>${marker.label}</span>`;
                    markerEl.style.setProperty('--marker-color', marker.color);
                    
                    const style = document.createElement('style');
                    style.textContent = `
                        .x-marker[style*="${marker.color}"]::before {
                            background: ${marker.color};
                        }
                    `;
                    document.head.appendChild(style);
                    
                    indicators.appendChild(markerEl);
                });
                
                container.appendChild(indicators);
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function toggleAdvanced() {
            const content = document.getElementById('advancedContent');
            const icon = document.getElementById('advancedIcon');
            
            content.classList.toggle('show');
            icon.classList.toggle('fa-chevron-down');
            icon.classList.toggle('fa-chevron-up');
        }

        function reloadCalculator() {
            // Reset all input values to defaults
            document.getElementById('mean').value = '0';
            document.getElementById('stddev').value = '1';
            document.getElementById('precision').value = '4';
            document.getElementById('chartRange').value = '4';
            
            // Reset radio button to default
            const probabilityRadio = document.querySelector('input[value="probability"]');
            if (probabilityRadio) {
                probabilityRadio.checked = true;
                currentCalcType = 'probability';
            }
            
            // Reset advanced options
            const advancedContent = document.getElementById('advancedContent');
            const advancedIcon = document.getElementById('advancedIcon');
            if (advancedContent && advancedIcon) {
                advancedContent.classList.remove('show');
                advancedIcon.classList.remove('fa-chevron-up');
                advancedIcon.classList.add('fa-chevron-down');
            }
            
            // Reset tab to PDF view
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            const pdfTab = document.querySelector('.tab');
            const pdfTabContent = document.getElementById('pdfTab');
            if (pdfTab) pdfTab.classList.add('active');
            if (pdfTabContent) pdfTabContent.classList.add('active');
            
            updateInputSection();
            updateRadioSelection();
            updateStatistics();
            calculate();
        }
    </script>
</body>
</html>
